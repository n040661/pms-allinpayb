<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dominator.mapper.ext.TRoleExt">
    <resultMap id="BaseResultMap" type="Dto">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Apr 16 00:55:47 CST 2018.
        -->
        <id column="id" jdbcType="VARCHAR" property="id"/>
        <result column="user_name" jdbcType="VARCHAR" property="userName"/>
        <result column="full_name" jdbcType="VARCHAR" property="fullName"/>
        <result column="password" jdbcType="VARCHAR" property="password"/>
        <result column="nick_name" jdbcType="VARCHAR" property="nickName"/>
        <result column="gender" jdbcType="VARCHAR" property="gender"/>
        <result column="phone_num" jdbcType="VARCHAR" property="phoneNum"/>
        <result column="id_card" jdbcType="VARCHAR" property="idCard"/>
        <result column="email" jdbcType="VARCHAR" property="email"/>
        <result column="head_img" jdbcType="VARCHAR" property="headImg"/>
        <result column="pid" jdbcType="VARCHAR" property="pid"/>
        <result column="device_num" jdbcType="VARCHAR" property="deviceNum"/>
        <result column="ip" jdbcType="VARCHAR" property="ip"/>
        <result column="login_type" jdbcType="VARCHAR" property="loginType"/>
        <result column="associated_qq" jdbcType="VARCHAR" property="associatedQq"/>
        <result column="associated_wb" jdbcType="VARCHAR" property="associatedWb"/>
        <result column="associated_wx" jdbcType="VARCHAR" property="associatedWx"/>
        <result column="country" jdbcType="VARCHAR" property="country"/>
        <result column="province" jdbcType="VARCHAR" property="province"/>
        <result column="city" jdbcType="VARCHAR" property="city"/>
        <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="modify_id" jdbcType="VARCHAR" property="modifyId"/>
        <result column="is_valid" jdbcType="VARCHAR" property="isValid"/>
        <result column="is_valid" jdbcType="VARCHAR" property="isValid"/>
        <result column="role_id" jdbcType="VARCHAR" property="roleId"/>
        <result column="user_id" jdbcType="VARCHAR" property="userId"/>
    </resultMap>
    <select id="getGardenRole" parameterType="Dto" resultType="Dto" resultMap="BaseResultMap">
        SELECT u.*, gur.role_id, u.id as user_id
        FROM t_garden_user_role gur, t_user u
        WHERE gur.is_valid = '1'
        AND u.is_valid = '1'
        AND u.id = gur.user_id
        AND gur.garden_id = #{gardenId}
        AND gur.role_id IN (
        SELECT id FROM t_role WHERE is_valid = '1' AND role_name = #{roleName}
        )
        limit 1
    </select>

    <select id="getCompanyRole" parameterType="Dto" resultType="Dto" resultMap="BaseResultMap">
        SELECT u.*, cur.role_id, u.id as user_id
        FROM t_company_user_role cur, t_user u
        WHERE cur.is_valid = '1'
        AND u.is_valid = '1'
        AND u.id = cur.user_id
        AND cur.company_id = #{companyId}
        AND cur.role_id IN (
        SELECT id FROM t_role WHERE is_valid = '1' AND role_name = #{roleName}
        )
        limit 1
    </select>
</mapper>