<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dominator.mapper.ext.TUserExt">
    <resultMap id="BaseResultMap" type="Dto" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon Apr 16 00:55:47 CST 2018.
        -->
        <id column="id" jdbcType="VARCHAR" property="id" />
        <result column="user_name" jdbcType="VARCHAR" property="userName" />
        <result column="full_name" jdbcType="VARCHAR" property="fullName" />
        <result column="password" jdbcType="VARCHAR" property="password" />
        <result column="nick_name" jdbcType="VARCHAR" property="nickName" />
        <result column="gender" jdbcType="VARCHAR" property="gender" />
        <result column="phone_num" jdbcType="VARCHAR" property="phoneNum" />
        <result column="id_card" jdbcType="VARCHAR" property="idCard" />
        <result column="email" jdbcType="VARCHAR" property="email" />
        <result column="head_img" jdbcType="VARCHAR" property="headImg" />
        <result column="pid" jdbcType="VARCHAR" property="pid" />
        <result column="device_num" jdbcType="VARCHAR" property="deviceNum" />
        <result column="ip" jdbcType="VARCHAR" property="ip" />
        <result column="login_type" jdbcType="VARCHAR" property="loginType" />
        <result column="associated_qq" jdbcType="VARCHAR" property="associatedQq" />
        <result column="associated_wb" jdbcType="VARCHAR" property="associatedWb" />
        <result column="associated_wx" jdbcType="VARCHAR" property="associatedWx" />
        <result column="country" jdbcType="VARCHAR" property="country" />
        <result column="province" jdbcType="VARCHAR" property="province" />
        <result column="city" jdbcType="VARCHAR" property="city" />
        <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
        <result column="modify_id" jdbcType="VARCHAR" property="modifyId" />
        <result column="is_valid" jdbcType="VARCHAR" property="isValid" />
        <result column="garden_user_role_id" jdbcType="VARCHAR" property="gardenUserRoleId" />
        <result column="garden_id" jdbcType="VARCHAR" property="gardenId" />
        <result column="user_id" jdbcType="VARCHAR" property="userId" />
        <result column="role_id" jdbcType="VARCHAR" property="roleId" />
        <result column="modules_ids" jdbcType="VARCHAR" property="modulesIds" />
        <result column="nick_name" jdbcType="VARCHAR" property="nickName" />
        <result column="hire_date" jdbcType="TIMESTAMP" property="hireDate" />
        <result column="fire_date" jdbcType="TIMESTAMP" property="fireDate" />
        <result column="work_num" jdbcType="VARCHAR" property="workNum" />
        <result column="department_name" jdbcType="VARCHAR" property="departmentName" />
        <result column="position" jdbcType="VARCHAR" property="position" />
        <result column="level" jdbcType="VARCHAR" property="level" />
        <result column="email" jdbcType="VARCHAR" property="email" />
        <result column="last_login_time" jdbcType="TIMESTAMP" property="lastLoginTime" />
        <result column="status" jdbcType="VARCHAR" property="status" />
        <result column="company_user_role_id" jdbcType="VARCHAR" property="companyUserRoleId" />
        <result column="company_id" jdbcType="VARCHAR" property="companyId" />
        <result column="user_id" jdbcType="VARCHAR" property="userId" />
        <result column="role_id" jdbcType="VARCHAR" property="roleId" />
        <result column="modules_ids" jdbcType="VARCHAR" property="modulesIds" />
        <result column="nick_name" jdbcType="VARCHAR" property="nickName" />
        <result column="hire_date" jdbcType="TIMESTAMP" property="hireDate" />
        <result column="fire_date" jdbcType="TIMESTAMP" property="fireDate" />
        <result column="work_num" jdbcType="VARCHAR" property="workNum" />
        <result column="department_name" jdbcType="VARCHAR" property="departmentName" />
        <result column="position" jdbcType="VARCHAR" property="position" />
        <result column="level" jdbcType="VARCHAR" property="level" />
        <result column="email" jdbcType="VARCHAR" property="email" />
        <result column="last_login_time" jdbcType="TIMESTAMP" property="lastLoginTime" />
        <result column="is_binding" jdbcType="VARCHAR" property="isBinding" />
        <result column="status" jdbcType="VARCHAR" property="status" />
        <result column="is_default" jdbcType="VARCHAR" property="isDefault" />
    </resultMap>

    <select id="gardenUserList" parameterType="Dto" resultType="Dto" resultMap="BaseResultMap">
        SELECT DISTINCT
        u.id,
        u.phone_num,
        gur.nick_name,
        gur.work_num,
        gur.department_name,
        gur.position,
        gur.hire_date,
        gur.fire_date,
        gur.status,
        gur.level,
        gur.email
        FROM t_user u, t_garden_user_role gur
        WHERE u.is_valid = '1'
        AND gur.is_valid = '1'
        AND gur.garden_id = #{gardenId}
        AND gur.user_id = u.id
        <if test="condition != null and !&quot;&quot;.equals(condition)">
            AND(
            gur.nick_name like concat('%', #{condition}, '%')
            or u.phone_num like concat('%', #{condition}, '%')
            or gur.work_num like concat('%', #{condition}, '%')
            )
        </if>
        <if test="status != null and !&quot;&quot;.equals(status)">
            AND gur.status = #{status}
        </if>
        ORDER BY gur.create_time ASC
    </select>

    <select id="companyUserList" parameterType="Dto" resultType="Dto" resultMap="BaseResultMap">
        SELECT DISTINCT
        u.id,
        u.phone_num,
        cur.nick_name,
        cur.work_num,
        cur.department_name,
        cur.position,
        cur.hire_date,
        cur.fire_date,
        cur.status,
        cur.level,
        cur.email
        FROM t_user u, t_company_user_role cur
        WHERE u.is_valid = '1'
        AND cur.is_valid = '1'
        AND cur.company_id = #{companyId}
        AND cur.user_id = u.id
        <if test="condition != null and !&quot;&quot;.equals(condition)">
            AND(
            cur.nick_name like concat('%', #{condition}, '%')
            or u.phone_num like concat('%', #{condition}, '%')
            or cur.work_num like concat('%', #{condition}, '%')
            )
        </if>
        <if test="status != null and !&quot;&quot;.equals(status)">
            AND gur.status = #{status}
        </if>
        ORDER BY gur.create_time ASC
    </select>

    <select id="getGardenUser" parameterType="Dto" resultType="Dto" resultMap="BaseResultMap">
        SELECT DISTINCT
        u.id,
        u.phone_num,
        gur.nick_name,
        gur.work_num,
        gur.department_name,
        gur.position,
        gur.hire_date,
        gur.fire_date,
        gur.status,
        gur.level,
        gur.email
        FROM t_user u, t_garden_user_role gur
        WHERE u.is_valid = '1'
        AND gur.is_valid = '1'
        AND gur.garden_id = #{gardenId}
        AND gur.user_id = u.id
        AND u.id = #{userId}
    </select>

    <select id="getCompanyUser" parameterType="Dto" resultType="Dto" resultMap="BaseResultMap">
        SELECT DISTINCT
        u.id,
        u.phone_num,
        cur.nick_name,
        cur.work_num,
        cur.department_name,
        cur.position,
        cur.hire_date,
        cur.fire_date,
        cur.status,
        cur.level,
        cur.email
        FROM t_user u, t_company_user_role cur
        WHERE u.is_valid = '1'
        AND cur.is_valid = '1'
        AND cur.company_id = #{companyId}
        AND cur.user_id = u.id
        AND u.id = #{userId}
    </select>
</mapper>